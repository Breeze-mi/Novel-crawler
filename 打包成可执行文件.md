# 打包成可执行文件完整指南

## 前置要求

- Python 3.8 或更高版本
- 已安装所有项目依赖（见 requirements.txt）
- Windows 系统（本指南针对 Windows，其他系统类似）

## 方法一：简单打包

### 1. 安装 PyInstaller

```bash
pip install pyinstaller
```

### 2. 进入项目目录

```bash
cd Novel-crawler
```

### 3. 执行打包命令

```bash
pyinstaller --onefile --windowed --name "小说阅读器" --icon=icon.ico novel_reader_pro.py
```

**参数说明**：

- `--onefile`: 打包成单个 .exe 文件（而不是文件夹）
- `--windowed`: 隐藏控制台窗口（GUI 应用推荐）
- `--name`: 设置可执行文件名称
- `--icon`: 设置应用图标（可选，需要 .ico 文件）

### 4. 获取可执行文件

打包完成后，可执行文件位于：

```
dist/小说阅读器.exe
```

---

## 方法二：完整打包

### 1. 创建打包配置文件

在项目根目录创建 `build.spec` 文件：

```python
# -*- mode: python ; coding: utf-8 -*-
import sys
from PyInstaller.utils.hooks import collect_submodules, collect_data_files

block_cipher = None

a = Analysis(
    ['novel_reader_pro.py'],
    pathex=[],
    binaries=[],
    datas=[
        # 添加数据文件（如果有）
        # ('data', 'data'),
    ],
    hiddenimports=[
        'PySide6',
        'requests',
        'bs4',
        'lxml',
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludedimports=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='小说阅读器',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,  # 隐藏控制台
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='icon.ico',  # 应用图标
)
```

### 2. 使用配置文件打包

```bash
pyinstaller build.spec
```

### 3. 获取可执行文件

```
dist/小说阅读器.exe
```

---

## 方法三：高级打包（包含所有资源）

### 1. 准备项目结构

```
Novel-crawler/
├── novel_reader_pro.py
├── kele_search.py
├── kele_search_window.py
├── analysis_index.py
├── styles.py
├── runlog.py
├── requirements.txt
├── icon.ico                    # 应用图标
├── data/                       # 数据目录（可选）
└── build_advanced.spec         # 打包配置
```

### 2. 创建高级配置文件 `build_advanced.spec`

```python
# -*- mode: python ; coding: utf-8 -*-
import sys
import os
from PyInstaller.utils.hooks import collect_submodules, collect_data_files

block_cipher = None

# 收集所有必要的隐藏导入
hiddenimports = [
    'PySide6',
    'PySide6.QtCore',
    'PySide6.QtGui',
    'PySide6.QtWidgets',
    'PySide6.QtWebEngineWidgets',
    'requests',
    'bs4',
    'lxml',
    'urllib3',
]

# 收集数据文件
datas = [
    # 如果有配置文件或资源文件，添加到这里
    # ('data', 'data'),
]

a = Analysis(
    ['novel_reader_pro.py'],
    pathex=[],
    binaries=[],
    datas=datas,
    hiddenimports=hiddenimports,
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludedimports=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyz,
    a.scripts,
    a.binaries,
    a.zipfiles,
    a.datas,
    [],
    name='小说阅读器',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    upx_exclude=[],
    runtime_tmpdir=None,
    console=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='icon.ico',
)

# 可选：创建 Windows 安装程序
# coll = COLLECT(
#     exe,
#     a.binaries,
#     a.zipfiles,
#     a.datas,
#     strip=False,
#     upx=True,
#     upx_exclude=[],
#     name='小说阅读器'
# )
```

### 3. 执行打包

```bash
pyinstaller build_advanced.spec
```

---

## 性能优化建议

### 1. 减少启动时间

```bash
# 使用 --onedir 而不是 --onefile（启动更快）
pyinstaller --onedir --windowed novel_reader_pro.py
```

### 2. 减少文件体积

```bash
# 排除不必要的模块
pyinstaller --onefile --exclude-module=numpy --exclude-module=pandas novel_reader_pro.py
```

### 3. 启用代码优化

```bash
# 使用 -O 参数优化 Python 代码
pyinstaller --onefile -O novel_reader_pro.py
```

---

## 获取帮助

如遇到打包问题，可以：

1. 查看 PyInstaller 的详细日志
2. 在 GitHub Issues 中提问
3. 参考 PyInstaller 官方文档
4. 尝试使用不同的打包参数

---

**最后更新**：2026-01-06
